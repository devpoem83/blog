---
title: "인덱스 설계시 고려사항"
date: 2020-07-23 15:44:00 -0400
categories: 개발
tags: 개발 인덱스 설계
---

# Clustered Index

물리적으로 테이블의 데이터를 재배열

- 데이터가 테이블에 삽입되는 순서에 상관없이 인덱스 컬럼을 기준으로 정렬되어 삽입됨. (ASC, DESC)
- 인덱스 페이지를 키값과 데이터 페이지의 번호로 구성하고, 검색하고자 하는 데이터의 키 값으로 페이지 번호를 알아내어 데이터를 찾음.

# Non-Clustered Index

물리적으로 데이터를 재정렬하지 않음

- 인덱스 페이지는 키값과 RID로 구성.
- RID는 파일그룹번호-데이터페이지번호-데이터페이지오프셋 으로 구성되는 포인팅 정보. (1-3-1 : 1번 파일그룹의 3번 데이터페이지의 1번째 데이터)

# 인덱스 비교

| 항목        |      Clustered Index      | Non-Clustered Index                                                                     |
| ----------- | :-----------------------: | :-------------------------------------------------------------------------------------- |
| `생성 개수` | 테이블당 1개만 생성 가능. | 테이블당 249개 생성가능.=> 많이 생성할 수록 DB의 디스크 및 유지보수 비용이 많이 필요함. |

I/O 낮음. 상대적으로 높음. (Key Lookup에서 많은 I/O 발생)
검색속도 높음. 상대적으로 낮음.
정렬
데이터 변경(insert, update, delete)시 재 정렬됨.

ASC, DESC 정렬선택 (테이블 성격에 따라)

재정렬 시 많은 비용발생.

정렬되지 않아 정렬에 대한 비용이 발생하지 않음.
키 선정
조회 및 JOIN 에 많이 사용되는 컬럼

범위 검색에 많이 사용되는 컬럼.

정렬(Order by)에 많이 사용되는 컬럼.

그루핑(Group by)에 많이 사용되는 컬럼.

검색조건에 많이 사용되는 컬럼.

Join에 사용되는 컬럼.

인덱스컬럼 외 조회 Index Seek 실행.
Index Seek + Key Lookup 실행.

(Key Lookup 에서 I/O 가 많아짐.)

1.  로그성 테이블 (Insert가 많이 발생하는 테이블)
    : 조회는 많이 발생하지 않는 테이블이라면 clustered Index를 생성하지 않는것이 효율적임. (재정렬비용이 발생하지 않음)

    예) eduwill_log.dbo.MYROOM_VISIT_LOG (나의강의실 페이지 접근이력 로그 테이블)

           - Clusted Index : 없음.

           - Non-Clustered Index : user_id, reg_date

2.  조회 테이블(Select가 많이 발생하는 테이블)
    : 조회 조건에 많이 사용되고 선택도가 뛰어난 컬럼을 Clustered Index로 생성.

    예) ganagosi_net2.dbo.product(강좌정보 테이블)

          - Clustered Index : productCode

          - Non-Clustered Index : Progress2, IsUse

          ※ 일려번호(idx)는 Index.로 설정하지 않음.  (일련번호는 단순 데이터번호만 기록하고 색인이나 JOIN에 사용되지 않음)

3.  Index 생성이 잘못된 유형

    - Where 절에서 사용되지 않는 컬럼 (단순 Sequence)

    - Where 절에서 변환되어 사용되는 컬럼

    - 선택도가 큰 컬럼. (예, 성별컬럼 - 선택도가 남/녀로 50% 밖에 되지 않음)

4.  실행계획

    - 여러 항목중 I/O 항목이 가장 중요함.

    - 설계하였던데로 인덱스가 잘 걸릴 수 있도록 쿼리를 작성.

    - JOIN이 많이 발생할 경우 여러가지 JOIN 케이스를 비교하여 최적화된 케이스로 작성.

5.  기타

    - PAD_Index

      : 중간 레벨을 적절히 비워 데이터 삽입 등에 대비하기 위해 설정.

    - Fillfactor

      : 리프 레벨을 적절히 비워 데이터 삽입 등에 대비하기 위해 설정.
