---
title: "인증 및 보안"
date: 2020-07-23 15:44:00 -0400
categories: 개발
tags: 개발 인증 보안
---

## 인증

- REST API를 호출한 사람(Client)가 적절한 사용자인지 판단해주는 것.

### API Key 인증 방식

- API 제공사의 API Key를 발급받아 API 호출시 Key를 메세지 안에 포함하여 호출하고, 서버는 메세지 안에서 Key를 추출하여 누가 호출한 API인지 인증하는 방식.
- 표준화가 되어있지 않음.

### OAuth 인증 방식

- OAuth Provider로 부터 인증을 받으면 OAuth Token이 생성된다. API 호출시 Token 을 함께 전송하여 인증하는 방식.
- OAuth 인증서버를 구축하여야 하기에 구현 난이도가 API Key 방식보다 높음.
- 표준화가 잘 되어있음.

### Bi-directionall Certification 인증방식

     - Https 통신을 사용할 때에 클라이언트에도 인증서를 놓고, 양방향 SSL을 제공하면서 API호출에 대한 인증을 클라이언트의 인증서를 통해서 하는 방식.
     - 구현 난이도가 가장 높고 복잡함
     : 일반적인 서비스에서는 사용되지 않으며, 몇몇 높은 인증수단을 제공해야하는 서비스나 특정 서버간의 보안통신을 위해서 사용 됨.

## 메세지 암호화

    API 내용안에 타인이 보아서는 안되는 내용이 있다면 API 메세지를 암호화하여야 한다.

### HTTPS

#### 서버 설정만으로 가능하고 신뢰할 수 있어 널리 사용되는 방식.

#### 문제점

: HTTPS 의 Client와 Server 사이에서 인증서를 바꿔치면, 바꿔친 사람은 메세지를 확인할 수 있다. (Man in middle attack)

    <시나리오>

    - Server A가 Client B에게 인증서를 내려 줌.
    - Hacker C가 중간에 Server A의 인증서를 자신의 인증서로 바꾸고 Client B에게 전달.
    - Client B가 Hacker C의 인증서로 메세지를 암호화해서 Server로 전송.
    - Hacker C가 중간에 Client B가 보낸 메세지를 자신의 인증서로 복호화하여 메세지 내용을 확인.
    - Hacker C가 메세지의 인증서를 Server A의 원래 인증서로 다시 암호화하여 Server A에 전송.
    - Server A는 문제가 없다고 판단.

3. 해결방법
   - Server A에서 공인된 인증서를 사용하고 Client B는 전달받은 인증서가 공인된 것인지 확인하는 과정(로직)을 추가하여 해결할 수 있음.

## 데이터 무결성 보장

    서버의 입장에서 API 호출을 받았을 때, 해당 호출이 신뢰할 수 있는지 구별하기 위함.
    Hacker 가 중간에 메세지를 가로채어 내용을 변조하고 Server에 보낼 수 있기에, 해당 데이터에 대한 무결성을 확인하여야 한다.

### HMAC 방식

- Client는 호출하고자 하는 URL과 전문을 암호화하여 Hash값을 생성하고 전문과 함께 Hash값을 전송한다.
- Server는 전달받은 데에터 중 URL과 전문 내용으로 Hash값을 생성한다.
- 생성된 Hash값과 전달받은 Hash 값을 비교하여 값이 상이할 경우 변조된 것으로 판단함.

#### 문제점

- 중간에 요청을 가로채고 내용을 변조하지 않고 동일한 요청을 Server로 계속 보낸다. Server는 변조하지 않았다고 판단하고 계속 유효한 호출로 인식한다. (replace attack)

#### 해결방법

- Client는 Hash값을 생성할 때에 Time Stamp 값을 포함하여 전송하고, Server는 전달받은 데이터의 유효한 시간을 확인하여 유효시간이 지난 요청은 거부함.

출처. http://bcho.tistory.com/807
