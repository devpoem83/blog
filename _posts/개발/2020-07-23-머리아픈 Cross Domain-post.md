---
title: "머리아픈 크로스도메인"
date: 2020-07-23 15:44:00 -0400
categories: 개발
tags: 개발 크로스도메인
---

## Cross Domain 간의 통신이 필요한 이유.

- Open API 를 통합 매시업(Mashup) 의 활성화.
- 여러 도메인을 사용해야하는 대규모 사이트 개발.
- 패밀리사이트(서브 도메인) 간의 데이터 송수신.

## 무너트려야 하는 자바스크립트 보안 정책

보안정책 : 동일 출처 허용 정책 (Same-Origin Policy)

- 동일출처란?
  : 프로토콜, 호스트명, 포트가 동일한 웹페이지
- 서로 다른 도메인에서 자바스크립트의 통신에 대해 보안상 접근을 거부 함. (샌드박스 정책)

## 무너트리는 대안에 대한 장/단점

### document.domain

- 특징 : 패밀리사이트(서브도메인)에서 사용이 가능함.
- 장점 : 설정이 간편 함.
- 단점 : 양방의 설정이 필요함. JSON, XML 기반의 API 서버로는 통신이 불가능 함.

### JSONP(JSON with Padding)

- 장점 : 서로 다른 도메인으로의 호출에 대한 결과를 callback 함수에 전달받을 수 있음.
- 단점 : POST방식의 요청이 불가능하여 multipart 또는 대량의 데이터 전송불가 함. 서버에서 JSONP에 대한 Response 처리가 필요함.

### IFrame IO

- 장점 : postMessage 함수를 사용하여 다른 도메인 간의 iframe 통신이 가능 함.
- 단점 : 서로간 통신할 출처를 명시하여야 사용이 가능.

### CORS (Cross-Origin Resource Sharing)

크로스 도메인 서버와 통신하기 위해 W3C에서 표준화한 교차 출처 자원공유 정책.
=> 요청받은 서버가 허락하면 크로스도메인이라도 Ajax 통신을 허용

- 장점 : 모든 요청으로부터 Cross Domain을 허용할 수 도 있고, 설정에 따라 특정 요청만 허용할 수 있음.
  클라이언트의 별도 설정이 필요하지 않음.
  XML, JSON 기반의 REST API 서버도 사용 가능.
- 단점 : IE9 이하에서의 이슈가 존재하여 그에대한 정책 및 대안이 필요함.

## IE 브라우저별 CORS 지원 현황

- IE6, 7 : 지원 불가.
- IE8, 9 : 지원 불가. 제한된 도메인 간의 요청만 허용하는 XDomainRequest ActiveX 컨트롤 지원. - 별도의 스크립트 처리가 필요.
  Edge, IE10이상 : 표준 지원.

## 나의강의실 Cross Domain 장애

### 발생배경

나의강의실 서버는 CORS 가 설정되어 있음.
통합플레이어 구동에 필요한 기능을 REST API 방식으로 제공.
패밀리사이트(브랜드 모바일)에 통합플레이어를 적용하기 위해 Ajax 모듈에 Cross Domain 설정 함.
IE10 이상, 크롬, 사파리 등 타 브라우저에서는 정상적으로 동작하지만 IE9 이하에서 Cross Domain 이슈가 발생.

### 원인

IE9 이하 버전에서는 Access-Control-Allow 헤더를 무시하고 출처 교차요청을 차단 함.
해결 법 - 브라우저 "도구 → 인터넷옵션 → 보안 → 사용자 지정수준 → [도메인 간 데이터 소스 액세스] "사용"으로 설정 필요. - XDomainRequest 를 사용하도록 별도 스크립트 처리가 필요.

### 추후 진행

IE9 에 대해 Cross Domain 을 적용할 수 있도록 여러 대안 테스트.
서비스 별 IE9 지원에 대한 정책 수립.
